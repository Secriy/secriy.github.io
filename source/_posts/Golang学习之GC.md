---
title: Golang学习之GC
date: 2021-04-21 13:10:35
categories: 学习笔记
tags:
  - Golang
  - Programming
---

{% noteblock quote cyan %}
本文是对 Golang 中垃圾处理机制的深入理解和学习。
{% endnoteblock %}

<!-- more -->

## 垃圾回收

编程语言在运行时会申请和分配内存给变量等，内存占用就会不断增大，因此需要垃圾回收（GC）机制去回收不再需要的内存空间。

垃圾回收机制一般分为手动和自动两种管理方式，如 C、C++、Rust 等编程语言采用手动的方式管理内存，需要程序员申请和释放内存。而 Python、Java、Go 等编程语言采用自动的内存管理方式。

### 常见的 GC 机制

最容易想到的 GC 方式是暂停程序 -> 回收内存 -> 恢复程序，然而随着程序的增多和规模的增大，暂停程序的方式严重影响了程序的可用性，因此现在已不再优先考虑。

#### 标记清除算法（Mark-Sweep）

标记清除算法是最常见的 GC 算法，可以分为 Mark（标记）和 Sweep（清除）两个过程：

1. Mark：从根对象触发查找并标记堆中所有存活的对象
2. Sweep：遍历堆中全部对象，清除未标记的对象并将回收的内存加入空闲链表，方便内存分配器重新利用分配

标记清除算法的缺陷是在标记过程中需要暂停程序（Stop the world，STW），并未解决这一问题。

### Golang 采用的 GC 机制

为了解决 STW 问题，Golang 采用的 GC 算法是**三色标记法**，它将对对象的标记分为三种：

- 白色：不确定的对象，即潜在的垃圾，可能会被回收
- 灰色：活跃的对象，需要扫描其子对象
- 黑色：活跃的对象，包括不存在任何引用外部指针的对象以及从根对象可达的对象
